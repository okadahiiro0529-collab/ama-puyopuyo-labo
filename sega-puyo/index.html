<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>Puyo-Puyo Training Project</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="css/style.css">

    <!-- Core config must come first -->
    <script src="src/config.js"></script>

    <!-- AI: stub / adapter - put BEFORE game.js so AIAdapter & AMA are available when game requests moves.
         Replace ama.browser.stub.js with real AMA bundle when ready. -->
    <!-- <script src="src/ama.browser.stub.js"></script> -->
    <script src="src/ai-adapter.js"></script>

    <!-- Game engine scripts -->
    <script src="src/stage.js"></script>
    <script src="src/score.js"></script>
    <script src="src/puyoimage.js"></script>
    <script src="src/player.js"></script>
    <script src="src/game.js"></script>

    <script>
      window.addEventListener('load', () => {
        // enable AI auto-play BEFORE initialize so the game loop sees it immediately
        Game.autoPlay = true;

        // now initialize the game (loop will start and newPuyo branch will use autoPlay)
        Game.initialize();

        // UI wiring (ai button) as before...
        const aiBtn = document.getElementById('aiMoveBtn');
        if (aiBtn) {
          aiBtn.innerText = Game.autoPlay ? 'AI: ON (shift-click to toggle)' : 'AI: OFF (click to single-move)';
          aiBtn.addEventListener('click', () => {
            if (Game.autoPlay) {
              Game.autoPlay = false;
              aiBtn.innerText = 'AI: OFF (click to single-move)';
            } else {
              Game.requestAIMove();
            }
          });
          aiBtn.addEventListener('mousedown', (ev) => { if (ev.shiftKey) { Game.autoPlay = !Game.autoPlay; aiBtn.innerText = Game.autoPlay ? 'AI: ON (shift-click to toggle)' : 'AI: OFF (click to single-move)'; }});
        }
      });
    </script>
  </head>
  <body>
    <img id="serverConnection">
    <div id="rivalBoard"></div>
    <div id="stage"></div>
    <div id="score"></div>
    <div id="nextPuyos"></div>
    <img id="nowLoading" src="img/nowLoading.gif">
    <img id="pause" src="img/pause.png">
    <img id="youWin" src="img/youWin.png">

    <div id="ojamaNotice"></div>

    <!-- AI control button -->
    <button id="aiMoveBtn" style="position: absolute; top: 10px; right: 10px; z-index: 999;">AI: OFF</button>

  </body>
</html>